<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Practical Schema Engineering: Tools and Techniques for schema-aware Kafka applications</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Practical Schema Engineering: Tools and Techniques for schema-aware Kafka applications</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#schema-creation-and-editing">2. Schema creation and editing</a>
<ul class="sectlevel2">
<li><a href="#schema-first-or-code-first">2.1. Schema-first or code-first?</a></li>
<li><a href="#manual-schema-editing">2.2. Manual schema editing</a></li>
<li><a href="#smoke-testing-avro-schema-documents">2.3. Smoke-testing AVRO schema documents</a></li>
<li><a href="#schema-first-generation-of-java-classes-from-schema">2.4. Schema-first: generation of Java classes from schema</a></li>
<li><a href="#code-first-generation-of-schema-documents-from-java-or-kotlin-classes">2.5. Code-first: generation of schema documents from Java or Kotlin classes</a></li>
<li><a href="#programmatic-creation">2.6. Programmatic creation</a></li>
</ul>
</li>
<li><a href="#documentation">3. Documentation</a>
<ul class="sectlevel2">
<li><a href="#avrodoc-based-documentation">3.1. Avrodoc-based documentation</a></li>
<li><a href="#asyncapi-specifications-and-documentation">3.2. AsyncAPI specifications and documentation</a></li>
<li><a href="#metadata-based-on-the-cloudevents-specification">3.3. Metadata based on the CloudEvents specification</a></li>
<li><a href="#self-description-and-discoverability">3.4. Self-description and discoverability</a></li>
</ul>
</li>
<li><a href="#test-driven-schema-compatibility-engineering">4. Test-driven schema compatibility engineering</a>
<ul class="sectlevel2">
<li><a href="#confluent-compatibility-model-for-schema-evolution">4.1. Confluent compatibility model for schema evolution</a></li>
<li><a href="#compatibility-testing-with-confluent-libraries">4.2. Compatibility testing with Confluent libraries</a></li>
</ul>
</li>
<li><a href="#publication-deployment">5. Publication / Deployment</a>
<ul class="sectlevel2">
<li><a href="#infrastructure-as-code">5.1. Infrastructure as code</a></li>
<li><a href="#automatic-deployment-of-schemas">5.2. Automatic deployment of schemas</a></li>
</ul>
</li>
<li><a href="#conclusion">6. Conclusion</a></li>
<li><a href="#acknowledgements">7. Acknowledgements</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Matthias Merdes<br>
Principal Software Architect<br>
Heidelberg Institute for Geoinformation Technology (HeiGIT)<br>
April/August 2022<br>
<a href="https://twitter.com/neckargold">@neckargold</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A lot has been written on software engineering in general.
While there is certainly not one universal definition of software engineering,
a pragmatic definition might include activities such as
versioning, automating, building, testing, documenting, and deploying certain artifacts, e.g. source code or compiled libraries
and performing those activities in a systematic, reproducible, tool-supported, and ideally automated manner.
This article aims at collecting and describing similar practices and tools for working with data schemas in the context of Kafka applications.</p>
</div>
<div class="paragraph">
<p>One major goal for any form of software engineering is to increase predictability by systematic actions
and to generally decrease the likelihood of surprises.
As surprises are more dangerous and damaging the later they happen,
an important aspect is to perform actions at development time rather than runtime.
To a considerable extent, this can be achieved in the schema engineering space as well.
Such schemas can be modelled, developed, tested, published, and referenced much in the same way as other artifacts.
As treating schemas as first-class citizens is a relatively new approach
- at least for Kafka-based systems -
a number of interesting challenges arise.
In the following, we will describe a 'practical schema engineering' approach
sharing lessons learned in the context of introducing Kafka at company-scale in a fintech.</p>
</div>
<div class="paragraph">
<p>When trying to constrain data by using a schema,
one of the first questions is which schema technology to choose.
A detailed discussion about the pros and cons of existing schema formats
is beyond the scope of this article.
As with most data-related topics, Martin Kleppmann&#8217;s book <a href="#DDIA">[DDIA]</a> is a very good reference for the various options.
At the time our project started (2020),
Apache Avro was clearly the dominant schema format in the Kafka community.
While support for other options such as ProtoBuf or JSON schema
has since been added to important tools such as schema registries,
Avro is probably still the most mature one.</p>
</div>
<div class="paragraph">
<p>The decision for or against using an explicit data schema is a fundamental one.
Using a schema in a Kafka project
usually means that the payload of Kafka messages must adhere to the rules contained in the schema.
This implies that Kafka clients, namely message producers and message consumers,
can take advantage of the meta-information encoded in the schema.
Of course, Kafka applications can be developed <em>without</em> using schemas at all.
This might even be the simplest solution for very small message data models or for immutable models
(say constrained by some external standard not expected to evolve during a project&#8217;s lifetime).
For most projects, however, usage of an explicit schema is beneficial
- especially if the Kafka system is part of a business-critical production system.
Making the structure of the message data explicit by using a schema
can move many surprises from runtime to developement time or at least deployment time.
This is comparable to a compiler which can detect many types of errors early compared to
an interpreted language which would fail only at runtime.
Obviously, this is highly desireable for every important system
- usually paying off the increased development-time cost many times over.
Interestingly, even traditionally schema-free NoSQL databases
such as MongoDB now offer optional schema constraint support
to facilitate the development of long-lived systems with non-trivial data structure.</p>
</div>
<div class="paragraph">
<p>In the following we will start with describing techniques
for developing, documenting, and describing schemas.
We will then describe some more advanced approaches for generating, manipulating,
and testing/compatibility-checking schemas at development or build time.
And of course, to be useful, schemas have to be deployed just as every other software artifact.</p>
</div>
<div class="paragraph">
<p>This article is not intended to be an introduction to Kafka itself or to (AVRO) schemas,
so a basic familiarity with both topics will be helpful.
It is also an <em>overview</em> article rather than a step-by-step tutorial,
so some details will have to be omitted.
All code examples are given as JUnit5 tests in Kotlin.
(better port to Java?)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="schema-creation-and-editing">2. Schema creation and editing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As hinted to above, a schema-based approach to Kafka messaging implies
that the payload of all messages on a given topic must be compliant
to the schema associated with that topic.
So the first step is to somehow create a schema document.
These schemas can be edited manually, derived from classes in a domain model
either at development time or on the fly upon first usage,
or even created programmatically.
We will give an overview over these options in the following sections
with an emphasis on editor and automation support.</p>
</div>
<div class="sect2">
<h3 id="schema-first-or-code-first">2.1. Schema-first or code-first?</h3>
<div class="paragraph">
<p>In order to create the actual schema document, i.e. an avsc-file in the case of AVRO schemas, there are two basic options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create schema by hand, then (optionally) generate Java classes</p>
</li>
<li>
<p>start with a Java or Kotlin model, then generate the schema document</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both approaches have their respective advantages and drawbacks.
If the starting point is a Java or Kotlin domain model,
then the full expressiveness of the underlying programming language can be used in the model,
i.e. inheritance, composition.
In the case of a Kotlin domain model,
even the nullability information of Kotlin&#8217;s type system can be used to create optional AVRO types.
See the avro4k library for an example of such capabilities.
A slight advantage for the schema-first approach is
that the majority of tools as well as documentation/tutorials seems to accept this as the default approach,
so it is maybe a bit easier to adopt.</p>
</div>
</div>
<div class="sect2">
<h3 id="manual-schema-editing">2.2. Manual schema editing</h3>
<div class="paragraph">
<p>A schema-first approach comes with its own special set of implications.
It is relatively cumbersome to maintain a large schema as the work has to be done
at the textual abstraction level.
This is partly alleviated by the capabilities of IDEs.
In addition to the standard support for highlighting basic JSON validation errors
some IDEs allow users to register the AVRO grammar (a form of 'metaschema' with respect to the domain schema)
and thus offer some basic code helping features (see image below).
Still, the AVRO grammar has limited expressiveness,
e.g. the concept of optionality has to be emulated by a union between the actual type and <code>null</code>.
Moreover, even with such IDE support, some important aspects, such as edit-time type safety are not well-supported
as shown in the next section.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/code-helping-with-avro-dialect.png" alt="code helping with avro dialect">
</div>
<div class="title">Figure 1. Code helping support in an IDE aware of the avsc schema grammar</div>
</div>
</div>
<div class="sect2">
<h3 id="smoke-testing-avro-schema-documents">2.3. Smoke-testing AVRO schema documents</h3>
<div class="paragraph">
<p>While code-helping support is very useful when composing a schema by hand,
its ability to detect errors is also rather limited.
Here, a simple smoke test can be a live-saver
when a large and/or complex schema is edited.
Even in small schema documents such as
the avsc snippet below (a slight modification of an example from the official AVRO guide)
some errors can be hard to spot.
Everything seems to look good: it is valid JSON and the IDE-based avsc-schema-checker does not complain.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/simple_invalid_schema_json.png" alt="simple invalid schema json">
</div>
<div class="title">Figure 2. A seemingly innocuous schema example (with a hidden error)</div>
</div>
<div class="paragraph">
<p>So let&#8217;s run the following smoke test against this innocent-looking schema document after performing some manual changes.</p>
</div>
<div class="listingblock">
<div class="title">An extremely simple smoke test to easily check schema validity</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">io.payment.schemaeng.compatibility</span>

<span class="k">import</span> <span class="nn">org.apache.avro.Schema</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>
<span class="k">import</span> <span class="nn">java.io.File</span>


<span class="kd">class</span> <span class="nc">SchemaSmokeTests</span> <span class="p">{</span>

    <span class="nd">@Test</span>
    <span class="k">fun</span> <span class="nf">`manually</span> <span class="n">edited</span> <span class="n">schema</span> <span class="n">document</span> <span class="n">can</span> <span class="n">be</span> <span class="n">parsed</span> <span class="k">as</span> <span class="n">valid</span> <span class="nf">schema`</span><span class="p">()</span> <span class="p">{</span>

        <span class="nc">Schema</span><span class="p">.</span><span class="nc">Parser</span><span class="p">().</span><span class="nf">parse</span><span class="p">(</span><span class="nc">File</span><span class="p">(</span><span class="s">"src/test/resources/schema/user.avsc"</span><span class="p">))</span>

    <span class="p">}</span>


<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alas, the test fails and we are alerted to a typing error in the schema (<code>integer</code> instead of the correct <code>int</code>)!</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/failed_schema_smoke_test.png" alt="failed schema smoke test">
</div>
<div class="title">Figure 3. A failed schema smoke test including a specific error message</div>
</div>
<div class="paragraph">
<p>Of course, carefully modelling a schema to represent the domain correctly is still a challenging human activity,
but the combination of JSON validation,
AVRO metaschema awareness of the IDE,
and such a simple smoke test goes a long way to make this activity less error-prone and frustrating.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-first-generation-of-java-classes-from-schema">2.4. Schema-first: generation of Java classes from schema</h3>
<div class="paragraph">
<p>If such a schema is to be used in producer, consumer, or streaming projects
then it is often helpful to generate a domain model from the schema.
For JVM-based projects the Apache AVRO library can be employed for this.
The <code>avro-tools</code> jar included in the distribution may be used for code generation and
a number of other features such as conversions between various AVRO representations.
In an automated build, the usage of an additional Gradle plugin can be very helpful
(e.g. <a href="https://github.com/davidmc24/gradle-avro-plugin" class="bare">https://github.com/davidmc24/gradle-avro-plugin</a>).</p>
</div>
<div class="paragraph">
<p>It should be noted that there might be cases where the generation of a domain model
from the schema can be omitted, especially for schemas which are small or of a simple structure
or in the realm of dynamically typed programming languages.
Even when working in a statically typed langage such as Java or Kotlin
it is possible to work with the generic types
<code>org.apache.avro.generic.IndexedRecord</code> and <code>org.apache.avro.generic.GenericRecord</code> from the Apache AVRO library
which allow for index- or name-based access to fields
instead of creating an explicit domain model.
In most cases, however, the generation of an explicit model should be of advantage.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-first-generation-of-schema-documents-from-java-or-kotlin-classes">2.5. Code-first: generation of schema documents from Java or Kotlin classes</h3>
<div class="paragraph">
<p>While many tutorials emphasize the quasi-standard tooling from Apache AVRO
to start with a schema and generate Java classes from it,
the opposite direction is also possible -
and may be simpler and more elegant in many cases <a href="#CodeFirst">[CodeFirst]</a>.</p>
</div>
<div class="paragraph">
<p>In the following we will give a small Kotlin-based example to illustrate the code-first approach,
taken again from a payment project.
It utilizes the avro4k library which is an extension of Kotlin&#8217;s serialization framework.
The <code>kotlinx.serialization</code> component also provides a gradle plugin which is run transparently during the compilation process.</p>
</div>
<div class="listingblock">
<div class="title">A Kotlin dataclass with avro4k annotations to control the schema generation process</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="nd">@Serializable</span>
<span class="nd">@AvroDoc</span><span class="p">(</span><span class="s">"Top-level representation of a merchant configuration to be consumed by PMPs"</span><span class="p">)</span>
<span class="nd">@AvroNamespace</span><span class="p">(</span><span class="s">"com.unzer.payment.configservice.message"</span><span class="p">)</span>
<span class="nd">@AvroName</span><span class="p">(</span><span class="s">"MerchantConfig"</span><span class="p">)</span>
<span class="nd">@AvroProp</span><span class="p">(</span><span class="s">"version"</span><span class="p">,</span> <span class="s">"0.0.2"</span><span class="p">)</span>
<span class="kd">data class</span> <span class="nc">MerchantConfig</span> <span class="k">constructor</span> <span class="p">(</span>

    <span class="nd">@AvroDoc</span><span class="p">(</span><span class="s">"Unique Id for the given merchant with respect to the legacy core system"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">uniqueId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>

    <span class="nd">@AvroDoc</span><span class="p">(</span><span class="s">"Version of the merchant object in ConfigService database"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">merchantVersion</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>

    <span class="nd">@AvroDoc</span><span class="p">(</span><span class="s">"The merchant's name"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>

    <span class="nd">@AvroDoc</span><span class="p">(</span><span class="s">"Unzer-wide unique Id"</span><span class="p">)</span>
    <span class="nd">@AvroDefault</span><span class="p">(</span><span class="nc">Avro</span><span class="p">.</span><span class="nc">NULL</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">unzerId</span><span class="p">:</span> <span class="nc">String</span><span class="p">?,</span>

    <span class="nd">@AvroDoc</span><span class="p">(</span><span class="s">"List of channels belonging to this merchant"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">channels</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Channel</span><span class="p">&gt;</span>

    <span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the Kotlin dataclass above, the <code>@Serialization</code> annotation marks the class as a candidate for serialization.
The <code>@Avro*</code> annotations are offered by the avro4k libary to control various aspects of the schema generation process.
Avro4k also provides a simple bridge to the Apache Avro data structure <code>org.apache.avro.generic.GenericRecord</code>
via this utility method: <code>com.github.avrokotlin.avro4k.Avro#toRecord()</code>.
This <code>GenericRecord</code> can then be used together with Confluent&#8217;s (de)serializers.
Accessing the generated schema is equally simple using the following method:
<code>com.github.avrokotlin.avro4k.Avro#schema()</code>.
The schema text is in avsc format
and can then be stored as a file for subsequent registration (see below).</p>
</div>
<div class="paragraph">
<p>It might be tempting not to extract the schema file at all
but to rely on auto-registration capabilities offered by some serializers
at the time of first message creation.
While this is technically possible
and may be acceptible for very simple schemas and during early development
or on non-production stages, many of the intended schema-related benefits (such as fast failure)
would be lost.</p>
</div>
<div class="paragraph">
<p>This approach avoids an explicit generation step during the build
like the one required for generating Java classes from a schema.
Moreover, the expressiveness of programming languages and the IDE tooling for working with Java or Kotlin codebases
are much more advanced than that for working with JSON-based avsc schemas.
For large and/or complex schemas this can make a huge difference.</p>
</div>
</div>
<div class="sect2">
<h3 id="programmatic-creation">2.6. Programmatic creation</h3>
<div class="paragraph">
<p>While the schema- or code-first approaches described above
are widely used and should be sufficient for most applications,
there is also a little-known alternative:
Building up a schema model by coding against an API.
The ubiquituous Apache Avro library allows just that.
The following class diagram shows the <code>org.apache.avro.Schema</code> interface and
a small yet representative subset of its 24 inner (sub)classes which implement the AVRO schema API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/avro_schema.png" alt="avro schema">
</div>
<div class="title">Figure 4. A (simplied) class diagram for the Apache Avro Schema hierarchy</div>
</div>
<div class="paragraph">
<p>As an example, we will create a very small AVRO schema programmatically.
This model consists of a single record with three differently typed fields only
but should suffice to show the technique in principle.
Imagine that we would like to model a simplified 'incident',
i.e. the occurrence of an urgent problem in a running software system.
This is a typical example for a messaging payload: a distinct <em>event</em> happening at a certain point of time.
The concrete task is then to create the following avsc file using the apache AVRO schema APIs:</p>
</div>
<div class="listingblock">
<div class="title">A simplified <code>Incident</code> schema to be created programmatically</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"record"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Incident"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"namespace"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"example.namespace"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"doc"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"a simple incident"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"production"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"timestamp"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following test we build up the schema programmatically
and then compare it to the avsc text file.</p>
</div>
<div class="listingblock">
<div class="title">An example for programmatic schema creation</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">io.payment.schemaeng.compatibility</span>

<span class="k">import</span> <span class="nn">org.apache.avro.Schema</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions.assertEquals</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>
<span class="k">import</span> <span class="nn">java.io.File</span>


<span class="kd">class</span> <span class="nc">SchemaCreationTests</span> <span class="p">{</span>


    <span class="k">private</span> <span class="kd">val</span> <span class="py">expectedSchema</span> <span class="p">=</span> <span class="nc">File</span><span class="p">(</span><span class="s">"src/test/resources/schema/incident.avsc"</span><span class="p">).</span><span class="nf">readText</span><span class="p">()</span>


    <span class="nd">@Test</span>
    <span class="k">fun</span> <span class="nf">`a</span> <span class="n">schema</span> <span class="n">can</span> <span class="n">be</span> <span class="n">created</span> <span class="nf">programmatically`</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">val</span> <span class="py">field1</span> <span class="p">=</span> <span class="nc">Schema</span><span class="p">.</span><span class="nc">Field</span><span class="p">(</span><span class="s">"title"</span><span class="p">,</span> <span class="nc">Schema</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nc">Schema</span><span class="p">.</span><span class="nc">Type</span><span class="p">.</span><span class="nc">STRING</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">field2</span> <span class="p">=</span> <span class="nc">Schema</span><span class="p">.</span><span class="nc">Field</span><span class="p">(</span><span class="s">"production"</span><span class="p">,</span> <span class="nc">Schema</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nc">Schema</span><span class="p">.</span><span class="nc">Type</span><span class="p">.</span><span class="nc">BOOLEAN</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">field3</span> <span class="p">=</span> <span class="nc">Schema</span><span class="p">.</span><span class="nc">Field</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="nc">Schema</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nc">Schema</span><span class="p">.</span><span class="nc">Type</span><span class="p">.</span><span class="nc">LONG</span><span class="p">))</span>

        <span class="kd">val</span> <span class="py">fields</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">field3</span><span class="p">)</span>

        <span class="kd">val</span> <span class="py">newSchema</span> <span class="p">=</span> <span class="nc">Schema</span><span class="p">.</span><span class="nf">createRecord</span><span class="p">(</span><span class="s">"Incident"</span><span class="p">,</span> <span class="s">"a simple incident"</span><span class="p">,</span> <span class="s">"example.namespace"</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
        <span class="nf">assertEquals</span><span class="p">(</span><span class="n">expectedSchema</span><span class="p">,</span> <span class="n">newSchema</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="k">true</span><span class="p">))</span>

    <span class="p">}</span>



<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Related techniques also allow for programmatic <em>manipulation</em> of schemas created by traditional (code-first or schema-first) means.
In our project we used such an approach to
automatically read an existing schema,
manipulate it programmatically,
and save it back.
The automatic manipulation step consisted of
adding several hundred possibilites for an ENUM to a certain field.
Those values originated in another system and would have been very cumbersome
and error-prone to maintain with a manual text-only approach.
In a similar vein,
we also employed such a technique to remove some specially marked fields of a large schema in a compatible way
in order to produce a special variant of the schema.
In this way, a family of schemas with varying content but guaranteed compatibility relationships can be created and maintained.
This can be seen as a form of variability management for schemas <a href="#SPLE">[SPLE]</a>.</p>
</div>
<div class="paragraph">
<p>A programmatic approach can also be used for AVRO schema creation
if another kind of model (say XML schema or some form of database schema) is the source of model truth and no other means of conversion exist.
While not recommended as a generic method to create new schemas from scratch,
a programmatic approach can simplify conversion from other schema representations
(or variability management for large and 'similar' schemas)
in selected situations.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="documentation">3. Documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documentation for any long-lived artifact is paramount to its usefulness.
While manually created documentation is rather unpopular with developers and generally hard to maintain,
an automated generation is often simple to set up and always stays in sync with the artifact.
In the following sections, we will discuss some tools that can read an avsc schema file
and produce a more human-readable documentation which is important for non-technical stake-holders.
The role of metadata and its relevance for interoperability is also discussed.</p>
</div>
<div class="sect2">
<h3 id="avrodoc-based-documentation">3.1. Avrodoc-based documentation</h3>
<div class="paragraph">
<p>In the Java world, Javadoc is a ubiquitous tool for such an automated creation of browsable documentation.
In a similar vein there is a tool named 'Avrodoc' for the Apache Avro space.
Originally created by Martin Kleppmann himself in 2012, it is not actively maintained anymore
but a number of forks exist which can be executed in a docker container with moderate effort.
Avrodoc reads a number of avsc files and generates an SPA from it in one self-contained HTML document.
This generation can be run for every change during a standard automatic build.
Technically, Avrodoc reads in the "doc" keys containing a description for every type.
Needless to say the quality of the resulting documentation depends heavily on the human-edited domain-related descriptions.
Other information such as domain datatype, technical type (e.g. enum, union, map etc), optionality,
or default values can be inferred from the schema as well
resulting in a complete functional and technical specification of the schema.
For an example generated from a detailed schema for financial transactions
see the following image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/txn-schema-avrodoc.png" alt="txn schema avrodoc">
</div>
<div class="title">Figure 5. Browsable html documentation generated from an avsc schema via avrodoc</div>
</div>
<div class="paragraph">
<p>The output of this tool is especially important for large schemas with tens or hundreds of types.
It can easily be deployed and used for communication with domain experts within a team
as well as for technical teams consuming data streams based on the schema in question.</p>
</div>
</div>
<div class="sect2">
<h3 id="asyncapi-specifications-and-documentation">3.2. AsyncAPI specifications and documentation</h3>
<div class="paragraph">
<p>While avrodoc works well it is not really supported anymore.
A more modern alternative is the usage of asyncAPI specifications.
Such specifications have a much wider scope than just schema documentation.
They represent complete descriptions of asynchronous systems,
roughly comparable to OpenAPI (Swagger) for REST systems <a href="#asyncAPI">[asyncAPI]</a>,
and details are thus beyond the scope of this article.
However, the asyncAPI tooling is up-to-date and maintained,
and the specification allows for referencing AVRO schemas when describing the payload of messages.
The <code>asyncapi generator</code> tool will then embed a browsable documentation of the AVRO schema.</p>
</div>
<div class="paragraph">
<p>An example from a simple use case in the payment domain
with a medium-sized schema can be seen in the following image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/asyncapi_html_with_schema_doc.png" alt="asyncapi html with schema doc">
</div>
<div class="title">Figure 6. HTML documentation including a browsable schema section, generated from an asyncAPI spec</div>
</div>
</div>
<div class="sect2">
<h3 id="metadata-based-on-the-cloudevents-specification">3.3. Metadata based on the CloudEvents specification</h3>
<div class="paragraph">
<p>In one of our use cases with an especially large and nested schema with frequent changes
it has also proved beneficial to model metadata explicitly and in a uniform way.
An emerging standard for defining the format of event data
is the CloudEvents specification (at version 1.0.2 at the time of writing).</p>
</div>
<div class="paragraph">
<p>This specification prescribes important metadata,
such as event id, creation timestamp, and a reference to the (AVRO) schema.
When such metadata is used for all topics on a company scale
it provides one important building block for a data catalogue.
In the future, standardized metadata may also play a crucial role
connecting systems of different enterprises <a href="#Flow">[Flow]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="self-description-and-discoverability">3.4. Self-description and discoverability</h3>
<div class="paragraph">
<p>While there is a small overlap beetween the AsyncAPI and CloudEvents specifications
they serve different purposes:
the former includes information on the whole event-driven systems
such as servers or security mechanisms.
The latter focus on the structure of the events themselves.
The former may include a reference to the whole schema, i.e. the domain aspect of an event,
the latter is restricted to the technical aspects shared by all events of a given topic.
Together both spefications can be viewed as simple building blocks for discoverability
and self-description, thus providing some first steps towards a data mesh <a href="#DataMesh">[DataMesh]</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-driven-schema-compatibility-engineering">4. Test-driven schema compatibility engineering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to work with schemas at run-time,
three things are neccessary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a schema compatibility model</p>
</li>
<li>
<p>a schema registry, i.e. a server component to serve schema versions to Kafka clients.</p>
</li>
<li>
<p>schema-aware (de)serializers used in producers and consumers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter are provided in the AVRO serialization libraries by Confluent
and work well with their schema registry product.
However, other compatible registries exist and may be used with the Confluent serializers.
In the following sections we will take a closer look at the very important concept of schema compatibility,
and how to check for such compatibility as early as possible.</p>
</div>
<div class="sect2">
<h3 id="confluent-compatibility-model-for-schema-evolution">4.1. Confluent compatibility model for schema evolution</h3>
<div class="paragraph">
<p>The systematic approach to schema compatibility in the Kafka space was pioneered by Confluent,
who also drive much of the development of the Kafka broker itself.
In order to reap the benefits of schema engineering at run-time,
a special component, called <code>schema registry</code> is needed.
Such a registry enables Kafka clients to check whether incoming messages are <em>compatible</em> with their local expectations.
Compatibility is a rather broad term and a fine-grained model of compatibility levels can help
with an adequate reaction to changing schemas.
The Confluent schema compatibility model <a href="#Evolution">[Evolution]</a> includes the following nuances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BACKWARD</code></p>
</li>
<li>
<p><code>BACKWARD_TRANSITIVE</code></p>
</li>
<li>
<p><code>FORWARD</code></p>
</li>
<li>
<p><code>FORWARD_TRANSITIVE</code></p>
</li>
<li>
<p><code>FULL</code></p>
</li>
<li>
<p><code>FULL_TRANSITIVE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apparently, there are three basic classes of compatibility modes, each coming in two flavors.
Generally, the <code>TRANSITIVE</code> postfix implies
that compatibility is checked against all previous versions along the schema history,
while the simple versions (without said postfix) require checks against the last version only.</p>
</div>
<div class="paragraph">
<p>While only <em>optional</em> fields may be added but <em>all</em> fields may be deleted for <code>BACKWARD</code> compatibility,
<code>FORWARD</code> compatibility allows <em>optional</em> fields to be deleted, and <em>all</em> fields to be added.
As the name implies, the <code>FULL</code> compatibility modes embody the strongest guarantees,
hence the least changes are allowed,
i.e. addition and deletion of optional fields only.
The benefit of this strict compatibility checking is that producer and consumer updates can be done in any order.</p>
</div>
<div class="paragraph">
<p>The main reason for employing such a compatibility model, and indeed the whole schema-based apprach,
is the ability to perform controlled migrations of producer and consumer systems.
In this context, a <code>forward</code> migration requires producers to be updated first
while a <code>backward</code> migration requires consumers to be updated first.</p>
</div>
</div>
<div class="sect2">
<h3 id="compatibility-testing-with-confluent-libraries">4.2. Compatibility testing with Confluent libraries</h3>
<div class="paragraph">
<p>One major advantage of a schema-centric approach is the ability to
do schema compatibility analysis and migration in a <em>controlled</em> way.</p>
</div>
<div class="paragraph">
<p>The following listing shows a simplied JUnit test for checking certain compatility levels between
the current (version 3.8) and the last (version 3.7) versions of a schema.</p>
</div>
<div class="listingblock">
<div class="title">An automated schema compatibility test for different versions</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">io.payment.schemaeng.compatibility</span>

<span class="k">import</span> <span class="nn">io.confluent.kafka.schemaregistry.avro.AvroSchema</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Assertions.assertTrue</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.DisplayName</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>
<span class="k">import</span> <span class="nn">java.io.File</span>


<span class="kd">class</span> <span class="nc">SchemaCompatibilityTests</span> <span class="p">{</span>

    <span class="kd">val</span> <span class="py">backwardChecker</span> <span class="p">=</span> <span class="n">io</span><span class="p">.</span><span class="n">confluent</span><span class="p">.</span><span class="n">kafka</span><span class="p">.</span><span class="n">schemaregistry</span><span class="p">.</span><span class="nc">CompatibilityChecker</span><span class="p">.</span><span class="nc">BACKWARD_CHECKER</span>
    <span class="kd">val</span> <span class="py">forwardChecker</span> <span class="p">=</span> <span class="n">io</span><span class="p">.</span><span class="n">confluent</span><span class="p">.</span><span class="n">kafka</span><span class="p">.</span><span class="n">schemaregistry</span><span class="p">.</span><span class="nc">CompatibilityChecker</span><span class="p">.</span><span class="nc">FORWARD_CHECKER</span>

    <span class="kd">val</span> <span class="py">schema37</span> <span class="p">=</span> <span class="nc">AvroSchema</span><span class="p">(</span><span class="nc">File</span><span class="p">(</span><span class="s">"src/test/resources/schema/p3-txn-schema-3.7-internal.avsc"</span><span class="p">).</span><span class="nf">readText</span><span class="p">())</span>
    <span class="kd">val</span> <span class="py">schema38</span> <span class="p">=</span> <span class="nc">AvroSchema</span><span class="p">(</span><span class="nc">File</span><span class="p">(</span><span class="s">"src/test/resources/schema/p3-txn-schema-3.8-internal.avsc"</span><span class="p">).</span><span class="nf">readText</span><span class="p">())</span>


    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"schema version 3.8 is forward-compatible with version 3.7"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">schemaIsForwardCompatibleWithOlderVersion</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">assertTrue</span><span class="p">(</span><span class="n">schema38</span> <span class="n">isForwardCompatibleWith</span> <span class="n">schema37</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"schema version 3.8 is backward-compatible with version 3.7"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">schemaIsBackwardCompatibleWithOlderVersion</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">assertTrue</span><span class="p">(</span><span class="n">schema38</span> <span class="n">isBackwardCompatibleWith</span> <span class="n">schema37</span><span class="p">)</span>
    <span class="p">}</span>


    <span class="k">infix</span> <span class="k">fun</span> <span class="nc">AvroSchema</span><span class="p">.</span><span class="nf">isBackwardCompatibleWith</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">AvroSchema</span><span class="p">)</span> <span class="p">=</span> <span class="n">backwardChecker</span>
        <span class="p">.</span><span class="nf">isCompatible</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">isEmpty</span><span class="p">()</span>

    <span class="k">infix</span> <span class="k">fun</span> <span class="nc">AvroSchema</span><span class="p">.</span><span class="nf">isForwardCompatibleWith</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">AvroSchema</span><span class="p">)</span> <span class="p">=</span> <span class="n">forwardChecker</span>
        <span class="p">.</span><span class="nf">isCompatible</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">isEmpty</span><span class="p">()</span>


<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Such a test can be run in an IDE (as well as in a CI build) in the usual way:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/schema_compatibility_test_execution.png" alt="schema compatibility test execution">
</div>
<div class="title">Figure 7. Running an automated schema compatibility test</div>
</div>
<div class="paragraph">
<p>This approach has a huge benefit: Fast Failure.
It allows for finding unintended schema compatibility breaches early at development time
and not only at schema registration time.
Such fast feedback can save considerable trouble when handling non-trivial schemas.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="publication-deployment">5. Publication / Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="infrastructure-as-code">5.1. Infrastructure as code</h3>
<div class="paragraph">
<p>A major improvement to operating software has been the move in recent years towards <em>infrastructure as code</em> (IaC).
This implies the definition of infrastructure components in a textual format which can be versioned and collaborated upon.
Such definitions are then executed against a production requirement in an automated and reproducible manner -
a huge improvement over ad-hoc manual changes to infrastructure.
There are many such tools (Ansible, Puppet, Terraform) and various different approaches.
Often a dedicated configuration language with deliberately limited expressiveness is used
such as the Hashicorp Configuration Language (HCL) for Terraform
but recently libraries for expression infrastructure concerns in the main programming language have emerged, e.g. AWS CDK.</p>
</div>
</div>
<div class="sect2">
<h3 id="automatic-deployment-of-schemas">5.2. Automatic deployment of schemas</h3>
<div class="paragraph">
<p>Today, Kafka servers are increasingly hosted by specialized or general cloud companies,
the most prominent examples being Confluent Cloud, Aiven for Kafka, and AWS MSK.
These offerings vary greatly in terms of features, maturity, and level of abstraction
and a comparison is naturally beyond the scope of this article.
All of them offer a schema registry service to manage schemas and their evolving versions at run-time.
This was pioneered by Confluent, but open source alternatives (e.g. Karapace by Aiven) or proprietary systems
(such as the Glue Registry by AWS) exist.</p>
</div>
<div class="paragraph">
<p>While those hosted Kafka systems usually offer a GUI to define elements such as topics, users, ACLs, and schemas
it is highly preferable to define these building blocks in an IaC approach.
Here, we are particularly interested in managing schemas.
In our projects we had a good experience with deploying the schemas to the schema registry using Aiven&#8217;s Terraform provider.
If a Kafka cloud vendor does not support Terraform, there are usually other, sometimes proprietary IaC tools.
As a last resort, schemas can often be registered via a REST service offered by the cloud vendor.
One way or another, automated and reproducible deployment of schemas should be treated with the same care and rigor
as automated deployments of any other software component.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">6. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As laid out above, a surprising number of tools and techniques exist to
treat schemas as first-class citizens from a software engineering viewpoint.
However, there seems to be a lack of resources on those practices.
This article aims to fill this void by creating an overview
and starting point for further exploration.</p>
</div>
<div class="paragraph">
<p>In our experience, an <em>early</em> investment in schema engineering pays off very well.
It is, of course, possible to introduce schema-related practices iteratively,
but starting with a schema at all as early as possible is paramount.
Introducing a schema only when the application is already in production
is difficult and dangerous.
As many non-trivial use cases will require schema support in the long run anyway,
it will often be reasonable to reap the benefits in terms of
communication, predictability, and fast feedback as early as possible.</p>
</div>
<div class="paragraph">
<p>Happy Schema Engineering!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="acknowledgements">7. Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Special thanks go to Ulrike Stampa, Thilo Espenlaub, and Tess Akerlund at Unzer
for developing these ideas together and supporting this article, respectively.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="DDIA"></a>[DDIA] Martin Kleppmann:
'Designing Data-Intensive Applications: The Big Ideas Behind Reliable, Scalable, and Maintainable Systems'</p>
</li>
<li>
<p><a id="CodeFirst"></a>[CodeFirst] Stefano Zanella:
'Publishing Avro records to Kafka with Kotlin, avro4k and Spring Boot'</p>
</li>
<li>
<p><a id="asyncAPI"></a>[asyncAPI] Daniel Kocot:
'AsyncAPI – Documentation of event- and message-driven architectures'</p>
</li>
<li>
<p><a id="Evolution"></a>[Evolution] Confluent:
'Schema evolution and compatiblity' - <a href="https://docs.confluent.io/platform/current/schema-registry/avro.html" class="bare">https://docs.confluent.io/platform/current/schema-registry/avro.html</a></p>
</li>
<li>
<p><a id="Flow"></a>[Flow] James Urquhart:
'Flow Architectures: The Future of Streaming and Event-Driven Integration'</p>
</li>
<li>
<p><a id="DataMesh"></a>[DataMesh] Zhamak Dehghani:
'Data Mesh: Delivering Data-Driven Value at Scale'</p>
</li>
<li>
<p><a id="SPLE"></a>[SPLE] Pohl, Böckle, van der Linden:
'Software Product Line Engineering'</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-08-25 11:34:39 +0200
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</body>
</html>